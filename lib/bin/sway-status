#!/bin/sh

load_avg() {
  printf "load: %s" "$(cut -d' ' -f1-3 /proc/loadavg)"
}

local_date() {
  date +"%Y-%m-%d %H:%M:%S %Z"
}

utc_date() {
  if [ "$(date +"%Z")" != 'UTC' ]; then
    printf "%s" "$(date --utc +"%H:%M %Z") ($(date +"%:::z"))"
  fi
}

run() {
  prev=0
  for part in load_avg utc_date local_date; do
    if [ "$prev" -eq 1 ]; then
      printf "%s" ' â”‚ '
    fi
    val="$($part)"
    if [ -n "$val" ]; then
      printf "%s" "$val"
      prev=1
      val=''
    else
      prev=0
    fi
  done
}

# Must buffer text and print at once
printf "%s" "$(run)"
